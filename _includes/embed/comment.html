<script src="https://giscus.app/client.js"
    data-repo="{{ site.thirdparty.giscus.repo }}"
    data-repo-id="{{ site.thirdparty.giscus.repo-id}}"
    data-category="{{ site.thirdparty.giscus.category }}"
    data-category-id="{{ site.thirdparty.giscus.category-id }}"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async
></script>
<script>
    const setCommentTheme = (theme) => {
        document.querySelector("iframe.giscus-frame").contentWindow.postMessage({
            giscus: {
                setConfig: {
                    theme: {
                        "light": "light",
                        "dark": "dark_dimmed",
                    }[theme]
                }
            }
        }, "https://giscus.app")
    }

    window.addEventListener("message", (event) => {
        if (event.origin === "https://giscus.app") {
            setCommentTheme(document.documentElement.dataset.theme)
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.attributeName === "data-theme") {
                        setCommentTheme(mutation.target.getAttribute(mutation.attributeName))
                    }
                })
            })
            observer.observe(document.documentElement, { attributes: true })
        }
    })
</script>
